"use strict";(self["webpackChunkwore_house_orders"]=self["webpackChunkwore_house_orders"]||[]).push([[621],{9621:function(e,a,t){t.r(a),t.d(a,{default:function(){return d}});var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"WareHouseMain"},[e._m(0),t("div",{staticClass:"input-card-box"},[t("div",{staticClass:"input-item"},[t("input",{attrs:{type:"checkbox"},on:{click:function(a){return e.toggleScale()}}}),e._v("比例尺 ")]),t("div",{staticClass:"input-item"},[t("input",{attrs:{type:"checkbox",id:"toolbar"},on:{click:function(a){return e.toggleToolBar()}}}),e._v("工具条 ")]),t("div",{staticClass:"mapImg"},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.nearvalue,callback:function(a){e.nearvalue=a},expression:"nearvalue"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.isOrdMap?t("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary"},on:{click:e.addRoadLayer}},[e._v("打开卫星图层")]):t("el-button",{attrs:{type:"primary"},on:{click:e.removeSatellite}},[e._v("关闭卫星图层")]),e.nearData.length?t("el-button",{staticClass:"nearRoad",staticStyle:{"margin-left":"15px"},attrs:{type:"primary"},on:{click:e.planNearRoad}},[e._v("规划最短救援路径")]):e._e()],1)])])},i=[function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"map-box"},[t("div",{staticClass:"container",attrs:{id:"container"}},[t("div",{attrs:{id:"panel"}})])])}],o=t(6198),r=t(3019),l=(t(1249),t(9600),t(4916),t(4765),t(8309),t(8975),t(4665)),s={name:"WareHouseMain",data:function(){return{map:"",lang:"zh_cn",zoom:10,title:"",coon:[],content:[],infoWindow:null,markers:[],scale:null,isScale:!1,toolBar:null,isToolBar:!1,overView:null,isoverView:!1,nowMapImg:{title:"",src:"",type:""},satellite:null,isOrdMap:!0,options:[{label:"3公里",value:3e3},{label:"5公里",value:5e3},{label:"10公里",value:1e4},{label:"30公里",value:3e4},{label:"50公里",value:5e4}],nearvalue:1e4,nearData:[],nowFineData:null,driving:null,newfireData:[]}},components:{},computed:(0,r.Z)({},(0,l.rn)(["fireData"])),mounted:function(){this.initMap(),this.addMarker()},created:function(){var e=this;return(0,o.Z)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:console.log(e.fireData);case 1:case"end":return a.stop()}}),a)})))()},methods:{initMap:function(){this.map=new AMap.Map("container",{resizeEnable:!0,zoom:this.zoom,zooms:[7,30],center:[102.379164,27.853739],viewMode:"3D",lang:this.lang,mapStyle:"amap://styles/macaron",infoWindow:null}),this.scale=new AMap.Scale({visible:!1}),this.map.addControl(this.scale),this.toolBar=new AMap.ToolBar({visible:!1,position:{top:"110px",right:"40px"}}),this.map.addControl(this.toolBar)},toggleScale:function(){this.isScale?(this.isScale=!1,this.scale.hide()):(this.isScale=!0,this.scale.show())},toggleToolBar:function(){this.isToolBar?(this.isToolBar=!1,this.toolBar.hide()):(this.isToolBar=!0,this.toolBar.show())},addMarker:function(){var e=this;return(0,o.Z)(regeneratorRuntime.mark((function a(){var t,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(e.newfireData=e.fireData.map((function(e){return(0,r.Z)((0,r.Z)({},e),{},{coordinate:[e.jing,e.wei]})})),t=function(a){var t=new AMap.Marker({map:e.map,position:e.newfireData[a].coordinate,extData:e.newfireData[a],icon:new AMap.Icon({image:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ae070c7f-068d-4e5c-adf5-baf6760c9a2b/9e584737-de7e-48ec-8025-d6f822668e69.png",size:new AMap.Size(40,40),imageSize:new AMap.Size(40,40)})});e.markers.push(t),AMap.event.addListener(t,"click",(function(){e.title="火灾编号："+e.newfireData[a].index,e.coon=e.newfireData[a].coordinate,e.content=["火灾级别："+e.newfireData[a].level,"救援队伍规模："+e.newfireData[a].fmen,"起火原因："+e.newfireData[a].reason],e.infoWindow=new AMap.InfoWindow({isCustom:!0,content:e.createInfoWindow(e.title,e.coon,e.content.join("<br/>")),offset:new AMap.Pixel(16,-45)}),e.infoWindow.open(e.map,t.getPosition())}))},n=0;n<e.newfireData.length;n++)t(n);case 3:case"end":return a.stop()}}),a)})))()},createInfoWindow:function(e,a,t){var n=this,i=document.createElement("div");i.className="custom-info input-card content-window-card";var o=document.createElement("div"),r=document.createElement("div"),l=document.createElement("img");o.className="info-top",r.innerHTML=e,l.src="https://webapi.amap.com/images/close2.gif",l.onclick=this.closeInfoWindow,o.appendChild(r),o.appendChild(l),i.appendChild(o);var s=document.createElement("div");s.className="info-middle",s.style.backgroundColor="white",s.innerHTML=t;var c=document.createElement("div");c.className="openMap",c.innerHTML="查看周边消防设施",c.onclick=function(){n.openMapFun(a)},s.appendChild(c),i.appendChild(s);var p=document.createElement("div");p.className="info-bottom",p.style.position="relative",p.style.top="0px",p.style.margin="0 auto";var u=document.createElement("img");return u.src="https://webapi.amap.com/images/sharp.png",p.appendChild(u),i.appendChild(p),i},openMapFun:function(e){var a=this;console.log(e,this.nearvalue),this.map.clearMap(),this.addMarker(),AMap.service(["AMap.PlaceSearch"],(function(){var e=new AMap.PlaceSearch({type:"消防",pageSize:5,pageIndex:1,citylimit:!0,map:a.map,panel:"panel",autoFitView:!0}),t=a.coon;e.searchNearBy("",t,a.nearvalue,(function(e,t){console.log("周边结果",t),a.nearData=[],console.log(a.nearData),a.closeInfoWindow(),t.info?a.nearData=t.poiList.pois:a.$message({message:"当前范围内无符合条件救援设施，请扩大搜索范围。",type:"warning"})}))}))},planNearRoad:function(){var e=this;console.log("路径规划ready",this.coon,this.nearData),this.driving&&(this.driving.clear(),this.driving=null);for(var a=null,t=null,n=0;n<this.nearData.length;n++){var i=AMap.GeometryUtil.distance(this.coon,[this.nearData[n].location.R,this.nearData[n].location.Q]);a?i<a&&(a=i,t=this.nearData[n]):(a=i,t=this.nearData[n])}this.driving=new AMap.Driving({map:this.map}),this.driving.search(this.coon,[t.location.R,t.location.Q],(function(a,n){"complete"===a?(console.log("绘制驾车路线完成"),e.$notify({title:"成功",message:"周边最近消防救援设置为："+t.name,type:"success"})):console.log("获取驾车数据失败："+n)}))},closeInfoWindow:function(){this.map.clearInfoWindow()},addRoadLayer:function(){this.isOrdMap=!1,this.satellite=new AMap.TileLayer.Satellite,this.map.add(this.satellite)},removeSatellite:function(){this.isOrdMap=!0,this.map.remove(this.satellite)}}},c=s,p=t(1001),u=(0,p.Z)(c,n,i,!1,null,null,null),d=u.exports}}]);
//# sourceMappingURL=621-legacy.47a14179.js.map